<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>WhatsApp Group Finder - Hadayek El Ahram</title>
</head>
<body>
    <h2>بحث عن لينكات جروبات واتساب - حدائق الأهرام</h2>
    <button onclick="search()">Search</button>
    <button onclick="downloadCSV()">Download CSV</button>

    <ul id="results"></ul>

    <script>
        let currentLinks = [];

        async function search() {
            const res = await fetch("/search");
            const data = await res.json();
            currentLinks = data;

            const box = document.getElementById("results");
            box.innerHTML = "";

            data.forEach(link => {
                const li = document.createElement("li");
                li.innerHTML = `<a href="${link}" target="_blank">${link}</a>`;
                box.appendChild(li);
            });
        }

        function downloadCSV() {
            if(currentLinks.length === 0) return alert("No links to download");

            const csvContent = "data:text/csv;charset=utf-8," 
                + currentLinks.join("\n");
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "whatsapp_links.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>
